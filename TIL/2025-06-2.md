# 스레드, 프로세스, 코어의 수는 많을 수록 좋을까요?

스레드, 프로세스, 코어 수가 많으면 작업이 빨라질 수는 있지만 이 모든건 메모리가 받춰줘야 빠른 작업이 가능합니다. 프로세스를 실행하기 위해 메모리에 올리고 cpu를 할당해주는 작업이 필요한데, 메모리가 작다면 디스크에 접근할 수 밖에 없습니다.

스레드, 프로세스, 코어의 수가 많을수록 시스템 성능이 향상된다고 생각할 수 있지만, 실제로는 그렇지 않을 확률이 큽니다.

## 스레드가 많으면

> 컨텍스트 스위칭, 자원 경쟁, 데드락, 동기화
> 스레드가 많으면 컨텍스트 스위칭을 많이하게 되면서 cpu자원을 많이 사용하게 됩니다(왜? 스레드 관리에 cpu 자원을 많이 사용하게된다. 스케줄링이란던가). 또한 동기화 문제라던가, 공유자원에 대한 경쟁도 심해질 것입니다.

스레드가 지나치게 많아지면 운영체제가 스레드 간 컨텍스트 스위칭을 자주 수행해야하여 CPU 자원이 스레드 관리에 소모됩니다. 이로 인해 실제 작업 수행 효율이 떨어질 수 있으며, 많은 스레드가 동시에 실행될 경우 메모리나 캐시, 락 등의 자원을 경쟁하게 되어 성능 저하나 데드락이 발생할 가능성이 높아집니다. 또한, 스레드가 많아지면 동기화와 상태 관리가 복잡해져 버그 발생 가능성도 커집니다.

## 프로세스가 많으면

> 독립된 메모리 공간, 메모리 공간, 프로세스 생성/관리에 자원 소모, 프로세스 실행 수에 제한
> 프로세스와 마찬가지로 컨텍스트 스위칭이 많이 발생하고, 프로세스 스케줄링에 많은 자원을 소모하면서 스케줄링에 사용되는 큐에도 병목현상이 발생할 수도 있습니다.

각 프로세스는 독립된 메모리 공간을 가집니다. 그래서 많은 프로세스가 동시에 실행되면 메모리 사용량이 급격히 증가할 수 있습니다. 또한 프로세스를 생성하고 관리하는 데에 상당한 시스템 자원이 소모되며, 프로세스 간 통신(IPC)이 필요할 경우 성능 저하가 발생할 수 있습니다. 프로세스 간 컨텍스트 스위칭은 스레드 간 컨텍스트 스위칭 보다 많은 오버헤드를 수반하기 때문에, 프로세스 수가 많아지면 시스템 성능이 저하될 수 있습니다. 운영체제는 동시에 실행할 수 있는 프로세스 수에 제한이 있으며, 이를 초과하면 새로운 프로세스 생성이 불가능하거나 시스템이 불안정해질 수 있습니다.

## 코어가 많으면

메모리에 올려진 작업들을 많이 실행할 수는 있으나 한번에 많은 프로세스를 동시에 실행하면 메모리에 많은 프로세스를 올리게 됩니다. 그러면 메모리 과부화가 와서 컴퓨터가 다운될수도 있다?
많은 코어를 가진 CPU는 병렬 처리 성능을 향상시킬 수 있지만, 이를 최대한 활용하기 위해서는 소프트웨어가 멀티코어 환경에 최적화되어 있어야합니다. 단일 스레드 작업이 주를 이루는 경우, 추가 코어의 이점을 제대로 활용하지 못할 수 있습니다. 또한, 코어 수가 많아질수록 CPU의 비용과 전력 소비가 증가할 수 있으며, 발열 관리도 더 복잡해집니다.

---

# [CPU가 멀티태스킹을 하는 방법](https://hongong.hanbit.co.kr/cpu%EA%B0%80-%EB%A9%80%ED%8B%B0%ED%83%9C%EC%8A%A4%ED%82%B9%EC%9D%84-%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-vs-%EC%8A%A4%EB%A0%88%EB%93%9C/)

컴퓨터는 어떻게 CPU 코어 수 보다 많은 작업을 멀티 태스킹 하는 것일까?
여러개의 프로세스를 동시에 처리하는 방법은 크게 2가지

## 첫번째, 병렬 처리 -> 멀티 코어

병렬 처리는 여러 작업을 동시에 실행하는 방법이다. 2개 이상의 코어가 다른 프로세스의 명령을 실행해서 각 프로세스가 같은 순간에 실행되도록 하는 방법이다.

## 두번째, 병행 처리 -> 싱글 코어

병행 처리는 하나의 코어가 여러 프로세스를 돌아가면서 조금씩 처리하는 것을 말한다. 실제로 프로세스가 동시에 실행되지 않지먄 CPU의 작업속도가 매우 빨라서 마치 동시에 여러 프로세스가 실행되는 것 처럼 보이도록 하는 것이다.  
CPU가 처리하는 프로세스가 변경되면 컨텍스트 스위칭이 발생한다. 이게 매우 빠르게 일어나기 때문에 컴퓨터를 사용할 때 여러 프로그램이 동시에 돌아가는 것처럼 느껴지는 것이다.

## 멀티 프로세싱

여러 개의 프로세스를 함께 진행하는 것을 멀티 프로세싱이라고 한다.

프로그램이 효율적으로 설계되었다면 여러개의 코어가 여러 개의 프로세스를 '병렬'로 분담해서 각자 맡은 역할을 '병행'해서 처리한다.  
예를 들어서 2코어에 4개의 프로세스를 돌려야한다면 각각 2개씩 프로세스를 담당하게 되고(병렬), 각자 맡은 2개의 프로세스를 '병행' 처리하는 것이다. (프로세스의 작업량에 따라 다르겠지만.. 일단 2개씩 할당되어 진다고 해보자) -> 멀티 코어로 병렬 처리 + 병행 처리

## 멀티 스레딩

프로세스의 작업 단위를 나눈 것을 스레드라고 하는데, 프로세스 안에서도 하나 이상의 작업을 실행할 수 있다.  
하나의 프로세스 안에서 여러 스레드가 실행되는 것이 멀티 스레딩이라고 한다.

### 프로세스와 스레드의 차이

메인 메모리를 어떻게 함께 사용하는가에 있다.  
멀티 프로세싱에서 각각의 프로세스는 메인 메모리에서 자신만의 독립적인 공간을 가지고 있다. 따라서 메모리를 차지하는 비율이 높다.  
멀티 스레딩은 프로세스에 할당된 메인 메모리 영역을 공유하고, 스레드의 독립된 작업을 위한 최소한의 독립된 공간을 가진다(stack, pc). 따라서 컨텍스트 스위칭 비용도 적고, 메모리도 적게 차지한다. 하지만 공유 영역에 대한 동기화 문제, 공유 자원 경쟁에 의한 데드락 등이 발생할 수 있으므로 이를 해결하기 위한 매커니즘 구현이 필요합니다.

### 프로그램을 실행하면 CPU가 하는일

> cpu의 구성요소: ALU, Register, 제어장치
>
> 1.  ALU: input에 대한 계산을 하고 output을 만든다
> 2.  Register: CPU 내의 작고 빠른 메모리, 연산 장치가 연산을 하기 위한 데이터가 들어있다.
> 3.  제어장치: CPU에서 명령어들의 길잡이 역할을 수행한다.
>     제어장치가 메모리에 있는 명령어나 데이터를 로드 -> 레지스터에 저장 -> ALU에게 계산하라고 명령하는 흐름을 제어한다.

> 프로그램: 어떤 일을 수행하기 위해 만들어진 명령어 모음, 프로그램은 보조 기억 장치에 저장되어 있는 정적인 상태

프로그램 실행 명령을 내리면 CPU는 보조 기억 장치(HDD, SSD)에서 꺼내 메인 메모리에 올리고 코드를 해석하며 작업을 시작한다.
여기서 멀티 프로세스 환경이라면 메모리에 올리는 프로세스를 선택하기 위해 CPU 스케줄링과 프로세스 스케줄링(프로세스 상태변경 + 상태에 따른 큐에 대기)이 활용된다.
