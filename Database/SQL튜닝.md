실제 현업에서 DB를 사용하면 성능이 느려지는 경우가 있다. 크게 3가지 요인으로 성능 저하를 경험한다고 한다.

1. 동시 사용자 수의 증가
2. 데이터 양의 증가
3. 비효율적인 SQL 작성
   DB 성능이 느려졌다면 서비스를 사용할 때 불편함을 느끼고, 이는 사용자 이탈로 이어진다.
   DBA가 있는데, 백엔드 개발자가 이런것도 알아야하나? 싶기도 하지만 DBA가 있는 회사에 가도 백엔드 개발자가 DB에 관련된 업무를 안하는게 아니다. 백엔드 개발자와 DBA가 같이 협업하면서 진행하는 경우도 있고, 기본적인 DB 성능 개선 작업은 백엔드 개발자가 직접하는 경우도 있다.

특히 최근 IT 서비스 기업의 회사 트렌드를 보면, 백엔드 개발자는 DB 설계부터 성능 개선을 하는 것까지는 기본 소양으로 여겨지고 있다.

## DB 성능 개선할 때 SQL 튜닝을 가장 먼저 해야하는 이유

### DB 성능을 개선하는 방법

DB 부하가 걸렸을 때 성능을 개선하는 방법은 다양하다.

1. SQL 튜닝
2. 캐싱 서버 활용(Redis 등)
3. 레플리케이션(Master/Slave 구조)
4. 샤딩
5. 스케일업(CPU, Memory, SSD 등 하드웨어 업그레이드)

이 중에서 왜 SQL튜닝을 먼저 고려하느냐?

1. SQL 튜닝을 제외한 나머지 방법은 추가적인 시스템을 구축해야 한다. 따라서 금전적, 시간적 비용이 추가적으로 발생한다. 조금 더 복잡해진 시스템 구조로 인해 관리 비용이 늘어난다. 그에 비해 SQL 튜닝은 기존의 시스템 변경 없이 성능을 개선할 수 있다.
2. 근본적인 문제를 해결하는 방법이 SQL 튜닝일 가능성이 높다. SQL 자체가 비효율적으로 작성됐다면 아무리 시스템적으로 성능을 개선한다고 하더라도 한계가 있다. 하지만 SQL 튜닝을 통해 기본적으로 성능을 향상시킨다면, 시스템적인 성능 개선이 필요없거나 훨씬 간단한 개선으로 큰 성능 개선 효과를 얻을 수 있다.

요약하자면, DB 성능 개선 방법들 중 가장 가성비가 좋은 방법이 SQL 튜닝인 것이다.

## MySQL 구조파악하기

어떤 부분에서 MySQL의 성능을 많이 잡아 먹는지, 어떤 요인이 주로 문제를 일으키는 지 파악할 수 있어야 한다. 그 원인을 파악하기 위해서는 MySQL 구조를 알아야만 한다.

MySQL의 아키텍처를 간단하게 표현하자면 위와 같다. 이 아키텍처에서 SQL문이 어떻게 실행되는 지 과정을 알아보자. MySQL 아키텍처에 대해 간단하게 정리해 놓은 [글](./MySQL.md)을 참고해보자.

1. 클라이언트가 DB에 SQL 요청을 보낸다.
2. MySQL 엔진에서 **옵티마이저**가 SQL문을 분석한 뒤 빠르고 효율적으로 데이터를 가져올 수 있는 계획을 세운다. 어떤 순서로 테이블에 접근할 지, 인덱스를 사용할 지, 어떤 인덱스를 사용할 지 등을 결정한다. **(옵티마이저가 세운 계획은 완벽하지 않다. 따라서 SQL 튜닝이 필요하다.)**
3. 옵티마이저가 세운 계획을 바탕으로 스토리지 엔진에서 데이터를 가져온다. **(DB 성능에 문제가 생기는 대부분의 원인은 스토리지 엔진으로부터 데이터를 가져올 때 발생한다. 데이터를 찾기가 어려워서 오래 걸리거나, 가져올 데이터가 너무 많아서 오래 걸린다. SQL 튜닝의 핵심은 스토리지 엔진으로부터 되도록이면 데이터를 찾기 쉽게 바꾸고, 적은 데이터를 가져오도록 바꾸는 것을 말한다.)**
4. MySQL 엔진에서 정렬, 필터링 등의 마지막 처리를 한 뒤에 클라이언트에게 SQL 결과를 응답한다.

## MySQL 구조파악하기

어떤 부분에서 MySQL의 성능을 많이 잡아 먹는지, 어떤 요인이 주로 문제를 일으키는 지 파악할 수 있어야 한다. 그 원인을 파악하기 위해서는 MySQL 구조를 알아야만 한다.

MySQL의 아키텍처를 간단하게 표현하자면 위와 같다. 이 아키텍처에서 SQL문이 어떻게 실행되는 지 과정을 알아보자.

1. 클라이언트가 DB에 SQL 요청을 보낸다.
2. MySQL 엔진에서 **옵티마이저**가 SQL문을 분석한 뒤 빠르고 효율적으로 데이터를 가져올 수 있는 계획을 세운다. 어떤 순서로 테이블에 접근할 지, 인덱스를 사용할 지, 어떤 인덱스를 사용할 지 등을 결정한다. **(옵티마이저가 세운 계획은 완벽하지 않다. 따라서 SQL 튜닝이 필요하다.)**
3. 옵티마이저가 세운 계획을 바탕으로 스토리지 엔진에서 데이터를 가져온다. **(DB 성능에 문제가 생기는 대부분의 원인은 스토리지 엔진으로부터 데이터를 가져올 때 발생한다. 데이터를 찾기가 어려워서 오래 걸리거나, 가져올 데이터가 너무 많아서 오래 걸린다. SQL 튜닝의 핵심은 스토리지 엔진으로부터 되도록이면 데이터를 찾기 쉽게 바꾸고, 적은 데이터를 가져오도록 바꾸는 것을 말한다.)**
4. MySQL 엔진에서 정렬, 필터링 등의 마지막 처리를 한 뒤에 클라이언트에게 SQL 결과를 응답한다.

**SQL 튜닝의 핵심 2가지**

> 1.  **스토리지 엔진에서 데이터를 찾기 쉽게 바꾸기**
> 2.  **스토리지 엔진으로부터 가져오는 데이터의 양 줄이기**

그럼 이 2가지를 어떻게 해결할 수 있을까?

여러가지 방법이 많지만 가장 많이 활용되는 방법이 **인덱스 활용**이다.
